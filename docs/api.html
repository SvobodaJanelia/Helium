<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Helium - API Documentation</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.1.1/tocbot.css">
        <link rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.12.0/build/styles/github.min.css">
        <link href="https://fonts.googleapis.com/css?family=Roboto|Slabo+27px|Roboto+Mono" rel="stylesheet"> 
        <link rel="stylesheet" href="styles/global.css">
        <link rel="stylesheet" href="styles/content-page.css">
        <link rel="stylesheet" href="styles/api.css">
        <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    </head>
    <body>
        <header>
            <div class="header-main">
                <div class="ptable-el">
                    <a href="index.html"><h1>He</h1></a>
                </div>
                <p>The open source DataJoint companion</p>
            </div>

            <nav>
                <a href="api.html">API</a>
                <a href="https://github.com/mattbdean/Helium">GitHub</a>
                <a href="https://github.com/mattbdean/Helium/blob/master/LICENSE">License</a>
            </nav>
        </header>

        <div class="page-content">
            <div class="api-docs">
                <h1>Authentication</h1>

                <p>
                    Helium does not have a direct authentication system, but rather creates database connections on
                    behalf of the user. As a result, Helium is capable of authenticating with any database using the
                    MySQL protocol. A connection is uniquely identified by the username, password, and host domain.
                    Currently, multiple users using the same connection works, but is unsupported behavior.
                <p>Once a connection has been established, an API key will be provided to the consumer. Every endpoint
                    besides <code>POST /api/v1/login</code> requires a <code>X-API-Key</code> header whose value is the
                    API key generated by the login endpoint.
                <p>To authenticate a MySQL user called "bob" identified by the password "hunter2" located on the host
                    "example.com", here's how the authentication process would happen:

                <pre>$ curl http://&lt;helium-domain&gt;:&lt;port&gt;/api/v1/login \
    --data "username=bob&amp;password=hunter2&amp;host=example.com"
{"apiKey":"my-api-key"}
                </pre>

                <p>To use any other endpoint</p>

                <pre>$ curl http://&lt;helium-domain&gt;:&lt;port&gt;/api/v1/schemas \
    -H "X-API-Key: my-api-key"
["foo", "bar", "baz"]
                </pre>

                <p>Sessions automatically expire after being out of use for a certain period of time (30 minutes by
                    default). Attempting to use the API key after that will result in a 401 Unauthorized. Every API
                    response using an API key will have a <code>X-Session-Expiration</code> header whose value is the
                    unix time (milliseconds) at which the API key expires.

                <h1>API Endpoints</h1>

                <h2>POST /api/v1/login</h2>

                <span class="chip chip-accepts">Accepts: <span class="monospace">application/x-www-form-urlencoded</span></span>
                <span class="chip chip-returns">Returns: <span class="monospace">application/json</span></span>

                <p>Attempts to establish a connection to a remote database. Returns an API key if successful.
                
                <h3>Form Parameters</h3>

                <ul>
                    <li><code>username</code></li>
                    <li><code>password</code></li>
                    <li><code>host</code></li>
                </ul>

                <h3>Sample response</h3>

                <pre><code class="json">{ "apiKey": "abcdefghijklmnopqrstuvwxyz" }</code></pre>

                <h2>GET /api/v1/schemas</h2>
                <span class="chip chip-returns">Returns: <span class="monospace">application/json</span></span>

                <p>Returns a list of schema names accessible to the authenticated user. Equivalent to running
                    <code>SHOW SCHEMAS;</code> in the MySQL console.

                <h3>Sample response</h3>

                <pre><code class="json">["foo", "bar", "baz"]</code></pre>

                <h2>GET /api/v1/schemas/:schema</h2>
                <span class="chip chip-returns">Returns: <span class="monospace">application/json</span></span>

                <p>Lists all tables in the given schema accessible to the current user.

                <h3>Sample response</h3>

                <p>Model documentation: <span data-api-model="BaseTableName">BaseTableName[]</span>

                <pre><code class="json">[  
    {  
        "schema": "helium_compound_fk_test",
        "name": {  
            "raw":"fk_table",
            "clean":"FkTable"
        },
        "tier": "manual",
        "masterName": null
    },
    {  
        "schema": "helium_compound_fk_test",
        "name": {  
            "raw": "table_a",
            "clean": "TableA"
        },
        "tier": "manual",
        "masterName": null
    },
    {  
        "schema": "helium_compound_fk_test",
        "name": {  
            "raw": "table_b",
            "clean": "TableB"
        },
        "tier": "manual",
        "masterName": null
    }
]</code></pre>

                <h2>GET /api/v1/schemas/:schema/:table</h2>
                <span class="chip chip-returns">Returns: <span class="monospace">application/json</span></span>

                <p>Gets metadata about a table, such as its headers, the total amount of rows, and constraints. Helium
                    supports primary, foreign, and unique constraints as well as compound primary and foreign constraints.

                <h3>Sample response</h3>
                <p>Model documentation: <span data-api-model>TableMeta</span>
                <pre><code class="json">{
    "schema": "helium_sample",
    "name": "big_table",
    "headers": [
        {
            "name": "pk",
            "type": "integer",
            "isNumerical": true,
            "isTextual": false,
            "signed": true,
            "ordinalPosition": 1,
            "rawType": "int(11)",
            "defaultValue": null,
            "nullable": false,
            "maxCharacters": null,
            "charset": null,
            "numericPrecision": 10,
            "numericScale": 0,
            "enumValues": null,
            "comment": "",
            "tableName": "big_table"
        }
    ],
    "totalRows":1000,
    "constraints":[
        {
            "type": "primary",
            "name": "PRIMARY",
            "constraints": [
                {
                    "localColumn": "pk",
                    "ref": null,
                    "type": "primary"
                }
            ]
        }
    ],
    "comment": "",
    "parts": []
}</code></pre>

                <h2>GET /api/v1/schemas/:schema/:table/column/:col</h2>
                <span class="chip chip-returns">Returns: <span class="monospace">application/json</span></span>

                <p>Fetches all data from a particular column. Useful for autocomplete on smaller tables.
                
                <h3>Sample response</h3>
                <pre><code class="json">["value 1", "value 2", "value 3"]</code></pre>

                <h2>GET /api/v1/schemas/:schema/:table/data</h2>
                <span class="chip chip-returns">Returns: <span class="monospace">application/json</span></span>

                <p>Fetches data from a specific table. Supports filtering and sorting, and is paginated data.
                
                <h3>Query parameters</h3>
                <ul>
                    <li><code>sort</code> (optional). The name of a column to sort by ascendingly, or a "-" and the name
                        of a column to sort descending. For example, If a table has a column named "foo", specifying
                        <code>sort=foo</code> would sort the data by foo from low to high, while <code>sort=-foo</code>
                        would accomplish the opposite.
                    <li><code>limit</code> (optional, default: 25). The maximum amount of items to return in a single
                        page. Accepts values between 1 and 100 (inclusive).
                    <li><code>page</code> (optional, default: 1). Page number to retrieve for pagination. Accepts values
                        greater than or equal to 1. If this value is too high, a 400 will be returned.
                    <li><code>filters</code> (optional). A JSON array of <span data-api-model="FooBar">Filter</span> objects.
                </ul>

                <h3>Sample response</h3>
                <p>Model documentation: <span data-api-model="PaginatedResponse">PaginatedResponse&lt;SqlRow&gt;</span>
                
                <pre><code class="json">{
    "size": 7,
    "data": [
        {
            "product_id": 20,
            "product_name": "Chicken breast (1 lb)",
            "price": 1.99
        },
        {
            "product_id": 21,
            "product_name": "Apples (1 lb)",
            "price": 1.99
        },
        {
            "product_id": 22,
            "product_name": "Soda",
            "price": 1.99
        },
        {
            "product_id": 23,
            "product_name": "Crackers",
            "price": 3.49
        },
        {
            "product_id": 24,
            "product_name": "Ice cream",
            "price": 3.99
        },
        {
            "product_id": 25,
            "product_name": "Oranges (1 lb)",
            "price": 2.99
        },
        {
            "product_id": 26,
            "product_name": "Bananas (1 lb)",
            "price": 0.79
        }
    ],
    "totalRows": 7
}
                </code></pre>

                <h2>GET /api/v1/schemas/:schema/:table/pluck</h2>
                <span class="chip chip-returns">Returns: <span class="monospace">application/json</span></span>
                <p>Grabs all rows from all part tables belonging to the specified table. Assumes DataJoint creates part
                    tables in the same schema as its master. The keys and values specified in the query are used to
                    uniquely identify exactly one row from the master table. The keys of the query parameters should be
                    column names, and the values should be specific values that exactly one column has. The most
                    efficient way of specifying the selectors is by using only the primary keys of the master table.
                
                <h3>Sample response</h3>
                <p>Model documentation: <span data-api-model>TableInsert</span>

                <pre><code class="json">{
    "master": [
        {
            "pk": 1000
        }
    ]
}
                </code></pre>

                <h2>PUT /api/v1/schemas/:schema/data</h2>
                <span class="chip chip-accepts">Accepts: <span class="monospace">application/json</span></span>
                <span class="chip chip-returns">Returns: <span class="monospace">application/json</span></span>

                <p>Inserts data into a table. Multiple tables are allowed if one of the tables is a master table and the
                    rest of the tables are part tables belonging to that table. Accepts a <span data-api-model>TableInsert</span>
                    in the HTTP request payload.
                
                <p>See <span data-gh-link="server/src/db/schema-input.validator.ts">SchemaInputValidator</span> for a
                    detailed overview of how data passed to this endpoint is validated.
            </div>

            <div class="toc sticky"></div>
        </div>

        <footer>
            Made with
            <svg class="heart-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                <path d="M0 0h24v24H0z" fill="none"/>
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
            </svg>
            by <a href="https://github.com/mattbdean">Matt Dean</a>
            for the <a href="https://www.janelia.org/lab/svoboda-lab">Svoboda Lab</a>
        </footer>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.1.1/tocbot.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.12.0/build/highlight.min.js"></script>
        <script src="js/api.js"></script>
    </body>
</html>
